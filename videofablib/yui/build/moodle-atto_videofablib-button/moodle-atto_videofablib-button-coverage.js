
var __cov_Vd6LMwQxUZNoTiIG6Y5KIg = (Function('return this'))();
if (!__cov_Vd6LMwQxUZNoTiIG6Y5KIg.__coverage__) { __cov_Vd6LMwQxUZNoTiIG6Y5KIg.__coverage__ = {}; }
__cov_Vd6LMwQxUZNoTiIG6Y5KIg = __cov_Vd6LMwQxUZNoTiIG6Y5KIg.__coverage__;
if (!(__cov_Vd6LMwQxUZNoTiIG6Y5KIg['build/moodle-atto_videofablib-button/moodle-atto_videofablib-button.js'])) {
   __cov_Vd6LMwQxUZNoTiIG6Y5KIg['build/moodle-atto_videofablib-button/moodle-atto_videofablib-button.js'] = {"path":"build/moodle-atto_videofablib-button/moodle-atto_videofablib-button.js","s":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0},"b":{"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0]},"f":{"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0},"fnMap":{"1":{"name":"(anonymous_1)","line":1,"loc":{"start":{"line":1,"column":42},"end":{"line":1,"column":61}}},"2":{"name":"(anonymous_2)","line":137,"loc":{"start":{"line":137,"column":15},"end":{"line":137,"column":26}}},"3":{"name":"(anonymous_3)","line":149,"loc":{"start":{"line":149,"column":31},"end":{"line":149,"column":43}}},"4":{"name":"(anonymous_4)","line":152,"loc":{"start":{"line":152,"column":32},"end":{"line":152,"column":44}}},"5":{"name":"(anonymous_5)","line":164,"loc":{"start":{"line":164,"column":16},"end":{"line":164,"column":28}}},"6":{"name":"(anonymous_6)","line":179,"loc":{"start":{"line":179,"column":20},"end":{"line":179,"column":31}}},"7":{"name":"(anonymous_7)","line":210,"loc":{"start":{"line":210,"column":23},"end":{"line":210,"column":34}}},"8":{"name":"(anonymous_8)","line":230,"loc":{"start":{"line":230,"column":36},"end":{"line":230,"column":48}}},"9":{"name":"(anonymous_9)","line":248,"loc":{"start":{"line":248,"column":23},"end":{"line":248,"column":40}}},"10":{"name":"(anonymous_10)","line":263,"loc":{"start":{"line":263,"column":24},"end":{"line":263,"column":42}}},"11":{"name":"(anonymous_11)","line":264,"loc":{"start":{"line":264,"column":11},"end":{"line":264,"column":28}}},"12":{"name":"(anonymous_12)","line":279,"loc":{"start":{"line":279,"column":25},"end":{"line":279,"column":40}}},"13":{"name":"(anonymous_13)","line":300,"loc":{"start":{"line":300,"column":31},"end":{"line":300,"column":42}}},"14":{"name":"(anonymous_14)","line":334,"loc":{"start":{"line":334,"column":13},"end":{"line":334,"column":25}}},"15":{"name":"(anonymous_15)","line":386,"loc":{"start":{"line":386,"column":18},"end":{"line":386,"column":29}}}},"statementMap":{"1":{"start":{"line":1,"column":0},"end":{"line":392,"column":61}},"2":{"start":{"line":36,"column":0},"end":{"line":97,"column":21}},"3":{"start":{"line":99,"column":2},"end":{"line":389,"column":5}},"4":{"start":{"line":139,"column":4},"end":{"line":144,"column":7}},"5":{"start":{"line":145,"column":4},"end":{"line":145,"column":86}},"6":{"start":{"line":146,"column":4},"end":{"line":146,"column":79}},"7":{"start":{"line":149,"column":4},"end":{"line":151,"column":13}},"8":{"start":{"line":150,"column":8},"end":{"line":150,"column":27}},"9":{"start":{"line":152,"column":4},"end":{"line":154,"column":13}},"10":{"start":{"line":153,"column":8},"end":{"line":153,"column":27}},"11":{"start":{"line":165,"column":4},"end":{"line":165,"column":25}},"12":{"start":{"line":167,"column":4},"end":{"line":167,"column":65}},"13":{"start":{"line":168,"column":4},"end":{"line":170,"column":5}},"14":{"start":{"line":169,"column":8},"end":{"line":169,"column":49}},"15":{"start":{"line":181,"column":4},"end":{"line":181,"column":61}},"16":{"start":{"line":182,"column":4},"end":{"line":184,"column":5}},"17":{"start":{"line":183,"column":8},"end":{"line":183,"column":15}},"18":{"start":{"line":187,"column":4},"end":{"line":187,"column":36}},"19":{"start":{"line":189,"column":4},"end":{"line":194,"column":7}},"20":{"start":{"line":197,"column":4},"end":{"line":198,"column":20}},"21":{"start":{"line":211,"column":4},"end":{"line":218,"column":12}},"22":{"start":{"line":220,"column":4},"end":{"line":220,"column":29}},"23":{"start":{"line":223,"column":4},"end":{"line":223,"column":47}},"24":{"start":{"line":225,"column":4},"end":{"line":225,"column":78}},"25":{"start":{"line":226,"column":4},"end":{"line":226,"column":78}},"26":{"start":{"line":227,"column":4},"end":{"line":227,"column":80}},"27":{"start":{"line":229,"column":5},"end":{"line":235,"column":6}},"28":{"start":{"line":230,"column":10},"end":{"line":234,"column":57}},"29":{"start":{"line":231,"column":14},"end":{"line":231,"column":43}},"30":{"start":{"line":232,"column":14},"end":{"line":232,"column":33}},"31":{"start":{"line":233,"column":14},"end":{"line":233,"column":99}},"32":{"start":{"line":237,"column":4},"end":{"line":237,"column":19}},"33":{"start":{"line":249,"column":4},"end":{"line":252,"column":5}},"34":{"start":{"line":250,"column":8},"end":{"line":250,"column":59}},"35":{"start":{"line":251,"column":8},"end":{"line":251,"column":39}},"36":{"start":{"line":264,"column":4},"end":{"line":269,"column":6}},"37":{"start":{"line":265,"column":8},"end":{"line":268,"column":9}},"38":{"start":{"line":266,"column":12},"end":{"line":266,"column":56}},"39":{"start":{"line":267,"column":12},"end":{"line":267,"column":43}},"40":{"start":{"line":280,"column":4},"end":{"line":280,"column":56}},"41":{"start":{"line":282,"column":4},"end":{"line":284,"column":5}},"42":{"start":{"line":283,"column":8},"end":{"line":283,"column":15}},"43":{"start":{"line":286,"column":4},"end":{"line":288,"column":5}},"44":{"start":{"line":287,"column":8},"end":{"line":287,"column":66}},"45":{"start":{"line":301,"column":4},"end":{"line":307,"column":14}},"46":{"start":{"line":309,"column":4},"end":{"line":311,"column":5}},"47":{"start":{"line":310,"column":8},"end":{"line":310,"column":41}},"48":{"start":{"line":313,"column":4},"end":{"line":319,"column":5}},"49":{"start":{"line":314,"column":8},"end":{"line":314,"column":30}},"50":{"start":{"line":315,"column":8},"end":{"line":315,"column":36}},"51":{"start":{"line":317,"column":8},"end":{"line":317,"column":51}},"52":{"start":{"line":318,"column":8},"end":{"line":318,"column":26}},"53":{"start":{"line":322,"column":4},"end":{"line":322,"column":31}},"54":{"start":{"line":323,"column":4},"end":{"line":323,"column":17}},"55":{"start":{"line":335,"column":4},"end":{"line":338,"column":32}},"56":{"start":{"line":340,"column":4},"end":{"line":340,"column":23}},"57":{"start":{"line":342,"column":4},"end":{"line":344,"column":5}},"58":{"start":{"line":343,"column":8},"end":{"line":343,"column":64}},"59":{"start":{"line":347,"column":4},"end":{"line":349,"column":5}},"60":{"start":{"line":348,"column":8},"end":{"line":348,"column":15}},"61":{"start":{"line":352,"column":4},"end":{"line":352,"column":17}},"62":{"start":{"line":353,"column":4},"end":{"line":369,"column":5}},"63":{"start":{"line":354,"column":8},"end":{"line":358,"column":9}},"64":{"start":{"line":355,"column":12},"end":{"line":355,"column":78}},"65":{"start":{"line":357,"column":12},"end":{"line":357,"column":54}},"66":{"start":{"line":361,"column":8},"end":{"line":361,"column":59}},"67":{"start":{"line":362,"column":8},"end":{"line":364,"column":11}},"68":{"start":{"line":366,"column":8},"end":{"line":366,"column":62}},"69":{"start":{"line":368,"column":8},"end":{"line":368,"column":27}},"70":{"start":{"line":371,"column":4},"end":{"line":373,"column":14}},"71":{"start":{"line":387,"column":10},"end":{"line":387,"column":23}}},"branchMap":{"1":{"line":168,"type":"if","locations":[{"start":{"line":168,"column":4},"end":{"line":168,"column":4}},{"start":{"line":168,"column":4},"end":{"line":168,"column":4}}]},"2":{"line":182,"type":"if","locations":[{"start":{"line":182,"column":4},"end":{"line":182,"column":4}},{"start":{"line":182,"column":4},"end":{"line":182,"column":4}}]},"3":{"line":229,"type":"if","locations":[{"start":{"line":229,"column":5},"end":{"line":229,"column":5}},{"start":{"line":229,"column":5},"end":{"line":229,"column":5}}]},"4":{"line":249,"type":"if","locations":[{"start":{"line":249,"column":4},"end":{"line":249,"column":4}},{"start":{"line":249,"column":4},"end":{"line":249,"column":4}}]},"5":{"line":265,"type":"if","locations":[{"start":{"line":265,"column":8},"end":{"line":265,"column":8}},{"start":{"line":265,"column":8},"end":{"line":265,"column":8}}]},"6":{"line":282,"type":"if","locations":[{"start":{"line":282,"column":4},"end":{"line":282,"column":4}},{"start":{"line":282,"column":4},"end":{"line":282,"column":4}}]},"7":{"line":286,"type":"if","locations":[{"start":{"line":286,"column":4},"end":{"line":286,"column":4}},{"start":{"line":286,"column":4},"end":{"line":286,"column":4}}]},"8":{"line":309,"type":"if","locations":[{"start":{"line":309,"column":4},"end":{"line":309,"column":4}},{"start":{"line":309,"column":4},"end":{"line":309,"column":4}}]},"9":{"line":313,"type":"if","locations":[{"start":{"line":313,"column":4},"end":{"line":313,"column":4}},{"start":{"line":313,"column":4},"end":{"line":313,"column":4}}]},"10":{"line":313,"type":"binary-expr","locations":[{"start":{"line":313,"column":8},"end":{"line":313,"column":14}},{"start":{"line":313,"column":18},"end":{"line":313,"column":31}}]},"11":{"line":342,"type":"if","locations":[{"start":{"line":342,"column":4},"end":{"line":342,"column":4}},{"start":{"line":342,"column":4},"end":{"line":342,"column":4}}]},"12":{"line":342,"type":"binary-expr","locations":[{"start":{"line":342,"column":7},"end":{"line":342,"column":34}},{"start":{"line":342,"column":38},"end":{"line":342,"column":60}}]},"13":{"line":347,"type":"if","locations":[{"start":{"line":347,"column":4},"end":{"line":347,"column":4}},{"start":{"line":347,"column":4},"end":{"line":347,"column":4}}]},"14":{"line":353,"type":"if","locations":[{"start":{"line":353,"column":4},"end":{"line":353,"column":4}},{"start":{"line":353,"column":4},"end":{"line":353,"column":4}}]},"15":{"line":354,"type":"if","locations":[{"start":{"line":354,"column":8},"end":{"line":354,"column":8}},{"start":{"line":354,"column":8},"end":{"line":354,"column":8}}]}},"code":["(function () { YUI.add('moodle-atto_videofablib-button', function (Y, NAME) {","","// This file is part of Moodle - http://moodle.org/","//","// Moodle is free software: you can redistribute it and/or modify","// it under the terms of the GNU General Public License as published by","// the Free Software Foundation, either version 3 of the License, or","// (at your option) any later version.","//","// Moodle is distributed in the hope that it will be useful,","// but WITHOUT ANY WARRANTY; without even the implied warranty of","// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the","// GNU General Public License for more details.","//","// You should have received a copy of the GNU General Public License","// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.","","/*"," * @package    atto_videofablib"," * @copyright  2013 Damyon Wiese  <damyon@moodle.com>"," * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later"," */","","/**"," * @module moodle-atto_videofablib_alignment-button"," */","","/**"," * Atto image selection tool."," *"," * @namespace M.atto_videofablib"," * @class Button"," * @extends M.editor_atto.EditorPlugin"," */","","var CSS = {","    RESPONSIVE: 'img-responsive',","    INPUTALT: 'atto_videofablib_altentry',","    INPUTHEIGHT: 'atto_videofablib_heightentry',","    INPUTSUBMIT: 'atto_videofablib_urlentrysubmit',","    INPUTURL: 'atto_videofablib_urlentry',","    INPUTSIZE: 'atto_videofablib_size',","    INPUTWIDTH: 'atto_videofablib_widthentry',","    IMAGEALTWARNING: 'atto_videofablib_altwarning',","    IMAGEBROWSER: 'atto_videofablib_openimagebrowser'","  },","  SELECTORS = {","    INPUTURL: '.' + CSS.INPUTURL","  },","  ","  REGEX = {","    ISPERCENT: /\\d+%/","  },","  ","  COMPONENTNAME = 'atto_videofablib',","  ","  TEMPLATE = '' +","        '<form class=\"atto_attoform\">' +","  ","            // Add the repository browser button.","            '{{#if showFilepicker}}' +","                '<div class=\"mb-1\">' +","                    '<label for=\"{{elementid}}_{{CSS.INPUTURL}}\">{{get_string \"enterurl\" component}}</label>' +","                    '<div class=\"input-group input-append w-100\">' +","                        '<input class=\"form-control {{CSS.INPUTURL}}\" type=\"url\" ' +","                        'id=\"{{elementid}}_{{CSS.INPUTURL}}\" size=\"32\"/>' +","                        '<span class=\"input-group-append\">' +","                            '<button class=\"btn btn-secondary {{CSS.IMAGEBROWSER}}\" type=\"button\">' +","                            '{{get_string \"browserepositories\" component}}</button>' +","                        '</span>' +","                    '</div>' +","                '</div>' +","            '{{else}}' +","                '<div class=\"mb-1\">' +","                    '<label for=\"{{elementid}}_{{CSS.INPUTURL}}\">{{get_string \"enterurl\" component}}</label>' +","                    '<input class=\"form-control fullwidth {{CSS.INPUTURL}}\" type=\"url\" ' +","                    'id=\"{{elementid}}_{{CSS.INPUTURL}}\" size=\"32\"/>' +","                '</div>' +","            '{{/if}}' +","  ","            // Hidden input to store custom styles.","            '<input type=\"hidden\" class=\"{{CSS.INPUTCUSTOMSTYLE}}\"/>' +","            '<br/>' +","  ","  ","            // Add the submit button and close the form.","            '<button class=\"btn btn-secondary {{CSS.INPUTSUBMIT}}\" type=\"submit\">' + '' +","                '{{get_string \"saveimage\" component}}</button>' +","            '</div>' +","        '</form>',","","  VIDEOTEMPLATE = '' +","            '<div class=\"atto_videofablib_videowrapper\">' +","            '<iframe src=\"{{url}}\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\"' +","            'allowfullscreen=\"\">' +","            '</iframe>' +","            '</div>';","  ","  Y.namespace('M.atto_videofablib').Button = Y.Base.create('button', Y.M.editor_atto.EditorPlugin, [], {","  /**","  * A reference to the current selection at the time that the dialogue","  * was opened.","  *","  * @property _currentSelection","  * @type Range","  * @private","  */","  _currentSelection: null,","  ","  /**","  * The most recently selected video.","  *","  * @param _selectedVideo","  * @type Node","  * @private","  */","  _selectedVideo: null,","  ","  /**","  * A reference to the currently open form.","  *","  * @param _attoform","  * @type Node","  * @private","  */","  _attoform: null,","  ","  /**","  * The dimensions of the raw image before we manipulate it.","  *","  * @param _rawImageDimensions","  * @type Object","  * @private","  */","  _rawImageDimensions: null,","  ","  initializer: function() {","  ","    this.addButton({","        icon: 'e/insert_edit_video',","        callback: this._displayDialogue,","        tags: '.attovideofablib',","        tagMatchRequiresAll: false","    });","    this.editor.delegate('dblclick', this._displayDialogue, '.attovideofablib', this);","    this.editor.delegate('click', this._handleClick, '.attovideofablib', this);","  ","    // e.preventDefault needed to stop the default event from clobbering the desired behaviour in some browsers.","    this.editor.on('dragover', function(e) {","        e.preventDefault();","    }, this);","    this.editor.on('dragenter', function(e) {","        e.preventDefault();","    }, this);","  },","  ","  /**","  * Handle a click on an image.","  *","  * @method _handleClick","  * @param {EventFacade} e","  * @private","  */","  _handleClick: function(e) {","    var image = e.target;","  ","    var selection = this.get('host').getSelectionFromNode(image);","    if (this.get('host').getSelection() !== selection) {","        this.get('host').setSelection(selection);","    }","  },","  ","  /**","  * Display the image editing tool.","  *","  * @method _displayDialogue","  * @private","  */","  _displayDialogue: function() {","    // Store the current selection.","    this._currentSelection = this.get('host').getSelection();","    if (this._currentSelection === false) {","        return;","    }","  ","    // Reset the image dimensions.","    this._rawImageDimensions = null;","  ","    var dialogue = this.getDialogue({","        headerContent: M.util.get_string('imageproperties', COMPONENTNAME),","        width: 'auto',","        focusAfterHide: true,","        focusOnShowSelector: SELECTORS.INPUTURL","    });","  ","    // Set the dialogue content, and then show the dialogue.","    dialogue.set('bodyContent', this._getDialogueContent())","            .show();","  },","  ","  ","  /**","  * Return the dialogue content for the tool, attaching any required","  * events.","  *","  * @method _getDialogueContent","  * @return {Node} The content to place in the dialogue.","  * @private","  */","  _getDialogueContent: function() {","    var template = Y.Handlebars.compile(TEMPLATE),","        canShowFilepicker = this.get('host').canShowFilepicker('media'),","        content = Y.Node.create(template({","            elementid: this.get('host').get('elementid'),","            CSS: CSS,","            component: COMPONENTNAME,","            showFilepicker: canShowFilepicker","        }));","   ","    this._attoform = content;","  ","    // Configure the view of the current image.","    this._applyImageProperties(this._attoform);","  ","    this._attoform.one('.' + CSS.INPUTURL).on('blur', this._urlChanged, this);","    this._attoform.one('.' + CSS.INPUTURL).on('blur', this._urlChanged, this);","    this._attoform.one('.' + CSS.INPUTSUBMIT).on('click', this._setVideo, this);","  ","     if (canShowFilepicker) {","          content.delegate('click', function(e) {","              var element = this._attoform;","              e.preventDefault();","              this.get('host').showFilepicker('media', this._getFilepickerCallback(element), this);","          }, '.atto_videofablib_openimagebrowser', this);","     }","  ","    return content;","  },","  ","  /**","  * Update the dialogue after an image was selected in the File Picker.","  *","  * @method _filepickerCallback","  * @param {object} params The parameters provided by the filepicker","  * containing information about the image.","  * @private","  */","  _filepickerCallback: function(params) {","    if (params.url !== '') {","        var input = this._attoform.one('.' + CSS.INPUTURL);","        input.set('value', params.url);","    }","  },","  ","  /**"," * Returns the callback for the file picker to call after a file has been selected."," *"," * @method _getFilepickerCallback"," * @param  {Y.Node} element The element which triggered the callback (atto form)"," * @return {Function} The function to be used as a callback when the file picker returns the file"," * @private"," */","_getFilepickerCallback: function(element) {","    return function(params) {","        if (params.url !== '') {","            var input = element.one('.' + CSS.INPUTURL);","            input.set('value', params.url);","        }","    };","},","  ","  /**","  * Applies properties of an existing image to the image dialogue for editing.","  *","  * @method _applyImageProperties","  * @param {Node} form","  * @private","  */","  _applyImageProperties: function(form) {","    var properties = this._getSelectedImageProperties();","  ","    if (properties === false) {  ","        return;","    }","  ","    if (properties.src) {","        form.one('.' + CSS.INPUTURL).set('value', properties.src);","    }","  },","  ","  /**","  * Gets the properties of the currently selected image.","  *","  * The first image only if multiple images are selected.","  *","  * @method _getSelectedImageProperties","  * @return {object}","  * @private","  */","  _getSelectedImageProperties: function() {","    var properties = {","            src: null","        },","  ","        // Get the current selection.","        videos = this.get('host').getSelectedNodes(),","        video;","  ","    if (videos) {","        videos = videos.filter('iframe');","    }","  ","    if (videos && videos.size()) {","        video = video.item(0);","        this._selectedVideo = video;","  ","        properties.src = video.getAttribute('src');","        return properties;","    }","  ","    // No image selected - clean up.","    this._selectedVideo = null;","    return false;","  },","","  ","  /**","  * Update the video in the contenteditable.","  *","  * @method _setVideo","  * @param {EventFacade} e","  * @private","  */","  _setVideo: function(e) {","    var form = this._attoform,","        url = form.one('.' + CSS.INPUTURL).get('value'),","        videohtml,","        host = this.get('host');","  ","    e.preventDefault();","  ","    if(url.includes('youtube.com') && !url.includes('embed')){","        url = 'https://www.youtube.com/embed/' + url.slice(-11);","    }","","    // Check if there are any accessibility issues.","    if (this._updateWarning()) {","        return;","    }","  ","    // Focus on the editor in preparation for inserting the image.","    host.focus();","    if (url !== '') {","        if (this._selectedVideo) {","            host.setSelection(host.getSelectionFromNode(this._selectedVideo));","        } else {","            host.setSelection(this._currentSelection);","        }","  ","  ","        var template = Y.Handlebars.compile(VIDEOTEMPLATE);","        videohtml = template({","            url: url","        });","  ","        this.get('host').insertContentAtFocusPoint(videohtml);","  ","        this.markUpdated();","    }","  ","    this.getDialogue({","      focusAfterHide: null","    }).hide();","  ","  },","  ","  ","  ","  /**","  * Update the alt text warning live.","  *","  * @method _updateWarning","  * @return {boolean} whether a warning should be displayed.","  * @private","  */","  _updateWarning: function() {","          return false;","  }","  });","  ","","}, '@VERSION@', {\"requires\": [\"moodle-editor_atto-plugin\"]});","","}());"]};
}
__cov_Vd6LMwQxUZNoTiIG6Y5KIg = __cov_Vd6LMwQxUZNoTiIG6Y5KIg['build/moodle-atto_videofablib-button/moodle-atto_videofablib-button.js'];
__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['1']++;YUI.add('moodle-atto_videofablib-button',function(Y,NAME){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.f['1']++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['2']++;var CSS={RESPONSIVE:'img-responsive',INPUTALT:'atto_videofablib_altentry',INPUTHEIGHT:'atto_videofablib_heightentry',INPUTSUBMIT:'atto_videofablib_urlentrysubmit',INPUTURL:'atto_videofablib_urlentry',INPUTSIZE:'atto_videofablib_size',INPUTWIDTH:'atto_videofablib_widthentry',IMAGEALTWARNING:'atto_videofablib_altwarning',IMAGEBROWSER:'atto_videofablib_openimagebrowser'},SELECTORS={INPUTURL:'.'+CSS.INPUTURL},REGEX={ISPERCENT:/\d+%/},COMPONENTNAME='atto_videofablib',TEMPLATE=''+'<form class="atto_attoform">'+'{{#if showFilepicker}}'+'<div class="mb-1">'+'<label for="{{elementid}}_{{CSS.INPUTURL}}">{{get_string "enterurl" component}}</label>'+'<div class="input-group input-append w-100">'+'<input class="form-control {{CSS.INPUTURL}}" type="url" '+'id="{{elementid}}_{{CSS.INPUTURL}}" size="32"/>'+'<span class="input-group-append">'+'<button class="btn btn-secondary {{CSS.IMAGEBROWSER}}" type="button">'+'{{get_string "browserepositories" component}}</button>'+'</span>'+'</div>'+'</div>'+'{{else}}'+'<div class="mb-1">'+'<label for="{{elementid}}_{{CSS.INPUTURL}}">{{get_string "enterurl" component}}</label>'+'<input class="form-control fullwidth {{CSS.INPUTURL}}" type="url" '+'id="{{elementid}}_{{CSS.INPUTURL}}" size="32"/>'+'</div>'+'{{/if}}'+'<input type="hidden" class="{{CSS.INPUTCUSTOMSTYLE}}"/>'+'<br/>'+'<button class="btn btn-secondary {{CSS.INPUTSUBMIT}}" type="submit">'+''+'{{get_string "saveimage" component}}</button>'+'</div>'+'</form>',VIDEOTEMPLATE=''+'<div class="atto_videofablib_videowrapper">'+'<iframe src="{{url}}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"'+'allowfullscreen="">'+'</iframe>'+'</div>';__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['3']++;Y.namespace('M.atto_videofablib').Button=Y.Base.create('button',Y.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_selectedVideo:null,_attoform:null,_rawImageDimensions:null,initializer:function(){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.f['2']++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['4']++;this.addButton({icon:'e/insert_edit_video',callback:this._displayDialogue,tags:'.attovideofablib',tagMatchRequiresAll:false});__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['5']++;this.editor.delegate('dblclick',this._displayDialogue,'.attovideofablib',this);__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['6']++;this.editor.delegate('click',this._handleClick,'.attovideofablib',this);__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['7']++;this.editor.on('dragover',function(e){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.f['3']++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['8']++;e.preventDefault();},this);__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['9']++;this.editor.on('dragenter',function(e){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.f['4']++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['10']++;e.preventDefault();},this);},_handleClick:function(e){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.f['5']++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['11']++;var image=e.target;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['12']++;var selection=this.get('host').getSelectionFromNode(image);__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['13']++;if(this.get('host').getSelection()!==selection){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['1'][0]++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['14']++;this.get('host').setSelection(selection);}else{__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['1'][1]++;}},_displayDialogue:function(){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.f['6']++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['15']++;this._currentSelection=this.get('host').getSelection();__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['16']++;if(this._currentSelection===false){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['2'][0]++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['17']++;return;}else{__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['2'][1]++;}__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['18']++;this._rawImageDimensions=null;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['19']++;var dialogue=this.getDialogue({headerContent:M.util.get_string('imageproperties',COMPONENTNAME),width:'auto',focusAfterHide:true,focusOnShowSelector:SELECTORS.INPUTURL});__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['20']++;dialogue.set('bodyContent',this._getDialogueContent()).show();},_getDialogueContent:function(){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.f['7']++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['21']++;var template=Y.Handlebars.compile(TEMPLATE),canShowFilepicker=this.get('host').canShowFilepicker('media'),content=Y.Node.create(template({elementid:this.get('host').get('elementid'),CSS:CSS,component:COMPONENTNAME,showFilepicker:canShowFilepicker}));__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['22']++;this._attoform=content;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['23']++;this._applyImageProperties(this._attoform);__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['24']++;this._attoform.one('.'+CSS.INPUTURL).on('blur',this._urlChanged,this);__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['25']++;this._attoform.one('.'+CSS.INPUTURL).on('blur',this._urlChanged,this);__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['26']++;this._attoform.one('.'+CSS.INPUTSUBMIT).on('click',this._setVideo,this);__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['27']++;if(canShowFilepicker){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['3'][0]++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['28']++;content.delegate('click',function(e){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.f['8']++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['29']++;var element=this._attoform;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['30']++;e.preventDefault();__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['31']++;this.get('host').showFilepicker('media',this._getFilepickerCallback(element),this);},'.atto_videofablib_openimagebrowser',this);}else{__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['3'][1]++;}__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['32']++;return content;},_filepickerCallback:function(params){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.f['9']++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['33']++;if(params.url!==''){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['4'][0]++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['34']++;var input=this._attoform.one('.'+CSS.INPUTURL);__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['35']++;input.set('value',params.url);}else{__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['4'][1]++;}},_getFilepickerCallback:function(element){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.f['10']++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['36']++;return function(params){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.f['11']++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['37']++;if(params.url!==''){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['5'][0]++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['38']++;var input=element.one('.'+CSS.INPUTURL);__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['39']++;input.set('value',params.url);}else{__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['5'][1]++;}};},_applyImageProperties:function(form){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.f['12']++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['40']++;var properties=this._getSelectedImageProperties();__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['41']++;if(properties===false){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['6'][0]++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['42']++;return;}else{__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['6'][1]++;}__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['43']++;if(properties.src){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['7'][0]++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['44']++;form.one('.'+CSS.INPUTURL).set('value',properties.src);}else{__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['7'][1]++;}},_getSelectedImageProperties:function(){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.f['13']++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['45']++;var properties={src:null},videos=this.get('host').getSelectedNodes(),video;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['46']++;if(videos){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['8'][0]++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['47']++;videos=videos.filter('iframe');}else{__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['8'][1]++;}__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['48']++;if((__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['10'][0]++,videos)&&(__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['10'][1]++,videos.size())){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['9'][0]++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['49']++;video=video.item(0);__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['50']++;this._selectedVideo=video;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['51']++;properties.src=video.getAttribute('src');__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['52']++;return properties;}else{__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['9'][1]++;}__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['53']++;this._selectedVideo=null;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['54']++;return false;},_setVideo:function(e){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.f['14']++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['55']++;var form=this._attoform,url=form.one('.'+CSS.INPUTURL).get('value'),videohtml,host=this.get('host');__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['56']++;e.preventDefault();__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['57']++;if((__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['12'][0]++,url.includes('youtube.com'))&&(__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['12'][1]++,!url.includes('embed'))){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['11'][0]++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['58']++;url='https://www.youtube.com/embed/'+url.slice(-11);}else{__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['11'][1]++;}__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['59']++;if(this._updateWarning()){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['13'][0]++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['60']++;return;}else{__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['13'][1]++;}__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['61']++;host.focus();__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['62']++;if(url!==''){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['14'][0]++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['63']++;if(this._selectedVideo){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['15'][0]++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['64']++;host.setSelection(host.getSelectionFromNode(this._selectedVideo));}else{__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['15'][1]++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['65']++;host.setSelection(this._currentSelection);}__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['66']++;var template=Y.Handlebars.compile(VIDEOTEMPLATE);__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['67']++;videohtml=template({url:url});__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['68']++;this.get('host').insertContentAtFocusPoint(videohtml);__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['69']++;this.markUpdated();}else{__cov_Vd6LMwQxUZNoTiIG6Y5KIg.b['14'][1]++;}__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['70']++;this.getDialogue({focusAfterHide:null}).hide();},_updateWarning:function(){__cov_Vd6LMwQxUZNoTiIG6Y5KIg.f['15']++;__cov_Vd6LMwQxUZNoTiIG6Y5KIg.s['71']++;return false;}});},'@VERSION@',{'requires':['moodle-editor_atto-plugin']});
